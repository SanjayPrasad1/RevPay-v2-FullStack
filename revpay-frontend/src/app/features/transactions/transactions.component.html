<div class="layout">
  <nav class="sidebar">
    <div class="brand">RevPay</div>
    <a class="nav-link" routerLink="/dashboard"><span class="material-icons">dashboard</span> Dashboard</a>
    <a class="nav-link active" routerLink="/transactions"><span class="material-icons">swap_horiz</span> Transactions</a>
    <a class="nav-link" routerLink="/money-requests"><span class="material-icons">request_page</span> Money Requests</a>
    <a class="nav-link" routerLink="/payment-methods"><span class="material-icons">credit_card</span> Payment Methods</a>
    <a class="nav-link" routerLink="/notifications"><span class="material-icons">notifications</span> Notifications</a>
    <ng-container *ngIf="isBusiness">
      <div class="nav-section">Business</div>
      <a class="nav-link" routerLink="/invoices"><span class="material-icons">receipt</span> Invoices</a>
      <a class="nav-link" routerLink="/loans"><span class="material-icons">account_balance</span> Loans</a>
    </ng-container>
    <div class="sidebar-footer">
      <a class="nav-link" routerLink="/profile"><span class="material-icons">person</span> Profile</a>
      <button class="nav-link btn-reset" (click)="logout()"><span class="material-icons">logout</span> Logout</button>
    </div>
  </nav>

  <main class="main-content">
    <div class="page-container">
      <div class="flex-row mb-24">
        <h2 style="margin:0">Transactions</h2>
        <span class="spacer"></span>
        <button mat-raised-button color="primary" (click)="openSend()">Send Money</button>&nbsp;
        <button mat-raised-button color="accent" (click)="openAddFunds()">Add Funds</button>&nbsp;
        <button mat-stroked-button (click)="exportCsv()">Export CSV</button>
      </div>

      <mat-card class="mb-24">
        <mat-card-content>
          <form [formGroup]="filterForm" (ngSubmit)="applyFilters()" class="filter-row">
            <mat-form-field>
              <mat-label>Type</mat-label>
              <mat-select formControlName="type">
                <mat-option value="">All</mat-option>
                <mat-option value="SEND">Sent</mat-option>
                <mat-option value="ADD_FUNDS">Added Funds</mat-option>
                <mat-option value="WITHDRAWAL">Withdrawal</mat-option>
              </mat-select>
            </mat-form-field>&nbsp;
            <mat-form-field>
              <mat-label>Status</mat-label>
              <mat-select formControlName="status">
                <mat-option value="">All</mat-option>
                <mat-option value="COMPLETED">Completed</mat-option>
                <mat-option value="PENDING">Pending</mat-option>
              </mat-select>
            </mat-form-field>&nbsp;
            <button mat-raised-button color="primary" type="submit">Filter</button>&nbsp;
            <button mat-button type="button" (click)="resetFilters()">Reset</button>
          </form>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-content>
          <div *ngIf="loading" style="display:flex;justify-content:center;padding:40px">
            <mat-spinner diameter="40"></mat-spinner>
          </div>
          <table mat-table [dataSource]="transactions" class="full-width" *ngIf="!loading">
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>Transaction ID</th>
              <td mat-cell *matCellDef="let t">{{ t.transactionId }}</td>
            </ng-container>
            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef>Type</th>
              <td mat-cell *matCellDef="let t"><span class="status-badge {{ t.type }}">{{ t.type }}</span></td>
            </ng-container>
            <ng-container matColumnDef="party">
              <th mat-header-cell *matHeaderCellDef>Party</th>
              <td mat-cell *matCellDef="let t">{{ t.senderName || t.receiverName || '-' }}</td>
            </ng-container>
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Amount</th>
              <td mat-cell *matCellDef="let t" [style.color]="t.type === 'ADD_FUNDS' ? '#4caf50' : '#f44336'">
                {{ t.amount | currency }}
              </td>
            </ng-container>
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let t"><span class="status-badge {{ t.status }}">{{ t.status }}</span></td>
            </ng-container>
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let t">{{ t.createdAt | date:'short' }}</td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
          <mat-paginator [length]="totalElements" [pageSize]="pageSize" [pageSizeOptions]="[10,20,50]"
            (page)="onPageChange($event)"></mat-paginator>
        </mat-card-content>
      </mat-card>
    </div>
  </main>
</div>
